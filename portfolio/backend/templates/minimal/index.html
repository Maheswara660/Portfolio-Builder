<!doctype html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>John Doe - Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        "space-grotesk": ["Space Grotesk", "sans-serif"],
                    },
                    animation: {
                        "blur-in": "blurIn 0.7s ease-out forwards",
                    },
                    keyframes: {
                        blurIn: {
                            "0%": { filter: "blur(5px)", opacity: "0" },
                            "100%": { filter: "blur(0)", opacity: "1" },
                        },
                    },
                    colors: {
                        // Semantic Tokyo Night Palette
                        canvas: "#1a1b26",       // Main Background
                        surface: "#24283b",      // Cards / Sections / Inputs
                        border: "#414868",       // Borders

                        heading: "#c0caf5",      // High contrast text
                        body: "#a9b1d6",         // Normal text
                        muted: "#787c99",        // Low contrast text

                        primary: "#7aa2f7",      // Blue
                        secondary: "#bb9af7",    // Purple
                        accent: "#7dcfff",       // Cyan
                        destructive: "#f7768e",  // Red

                        // Keep white/black true to reality for utility overrides if needed
                        white: "#ffffff",
                        black: "#000000",
                    },
                },
            },
            darkMode: "class", /* Force manual control or system pref, but we overrode colors above */
        };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap"
        rel="stylesheet" />
    <link rel="canonical" href="" id="canonical-link" />
    <style>
        .text-dynamic-primary {
            color: var(--primary-color);
        }
    </style>
</head>

<body class="bg-canvas text-body font-space-grotesk antialiased">
    <div id="app"></div>
    <script type="application/json" id="portfolio-data">
        {{ portfolio_data | tojson }}
    </script>
    <script>
        // Inject backend data directly using Jinja2
        const portfolioData = JSON.parse(document.getElementById('portfolio-data').textContent);

        async function loadPortfolioData() {
            return portfolioData;
        }

        function getIconSVG(name) {
            // ... (Icons remain the same, just keeping them for context if needed, but the tool will preserve them if I don't touch them? No, replace_file_content replaces the whole block. I need to re-include the icons or refer to them.)
            // Actually, to be safe and precise, I will re-include the necessary parts and just change the classes in the render function.
            const icons = {
                linkedin: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/></svg>',
                github: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>',
                twitter: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865l8.875 11.633Z"/></svg>',
                "arrow-up-right": '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M14 2.5a.5.5 0 0 0-.5-.5h-6a.5.5 0 0 0 0 1h4.793L2.146 13.146a.5.5 0 0 0 .708.708L13 3.707V8.5a.5.5 0 0 0 1 0v-6z"/></svg>',
                repo: '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>',
            };
            return icons[name] || "";
        }

        function createSectionDivider(title) {
            return `
    <div class="flex items-center my-8">
      <div class="flex-grow border-t border-border"></div>
      <h2 class="font-bold text-xl text-heading mx-4">${title}</h2>
      <div class="flex-grow border-t border-border"></div>
    </div>
  `;
        }

        function generateInitials(name) {
            if (!name) return "Me";
            const words = name.trim().split(" ");
            if (words.length === 1) {
                return words[0].charAt(0).toUpperCase();
            } else {
                return words.slice(0, 2).map((word) => word.charAt(0).toUpperCase()).join("");
            }
        }

        function ensureUrl(url) {
            if (!url) return url;
            if (!url.match(/^https?:\/\//)) {
                return `https://${url}`;
            }
            return url;
        }

        function setMetaTags(data) {
            const pageTitle = `${data.settings.name} - ${data.settings.title}`;
            const pageDescription = data.settings.summary;
            const pageImage = data.settings.profileImage;
            const pageUrl = window.location.href;

            document.title = pageTitle;

            const createOrUpdateMeta = (property, content, isNameAttribute = false) => {
                const attribute = isNameAttribute ? "name" : "property";
                let element = document.querySelector(`meta[${attribute}="${property}"]`);
                if (!element) {
                    element = document.createElement("meta");
                    element.setAttribute(attribute, property);
                    document.head.appendChild(element);
                }
                element.setAttribute("content", content);
            };

            createOrUpdateMeta("description", pageDescription, true);
            createOrUpdateMeta("og:title", pageTitle);
            createOrUpdateMeta("og:description", pageDescription);
            createOrUpdateMeta("og:image", pageImage);
            createOrUpdateMeta("og:url", pageUrl);
            createOrUpdateMeta("og:type", "website");
            createOrUpdateMeta("twitter:card", "summary_large_image", true);
            createOrUpdateMeta("twitter:title", pageTitle, true);
            createOrUpdateMeta("twitter:description", pageDescription, true);
            createOrUpdateMeta("twitter:image", pageImage, true);

            const canonical = document.getElementById("canonical-link");
            if (canonical) {
                canonical.setAttribute("href", pageUrl.split("#")[0]);
            }
        }

        async function renderPortfolio() {
            try {
                const data = await loadPortfolioData();

                setMetaTags(data);

                let socialLinksHTML = "";
                if (data.sections.social && data.sections.social.enabled) {
                    socialLinksHTML = data.sections.social.items
                        .map((item) => `
        <a href="${ensureUrl(item.url)}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-muted hover:text-heading transition-colors">
          ${getIconSVG(item.platform)}
          <span>${item.platform.charAt(0).toUpperCase() + item.platform.slice(1)}</span>
        </a>`)
                        .join('<span class="text-muted">/</span>');
                }

                let headerHTML = "";
                if (data.navigation && data.navigation.enabled) {
                    const navLinks = data.navigation.items
                        .map((item) => `
        <a href="${item.url}" class="px-3 py-2 text-sm rounded-full hover:bg-surface hover:text-heading transition-colors">${item.name}</a>
      `).join("");

                    // Header styling updated for visibility: bg-white/5 -> bg-surface, border-border
                    headerHTML = `
        <header class="hidden md:flex fixed top-4 left-1/2 -translate-x-1/2 z-50">
          <nav class="flex items-center gap-4 bg-surface border border-border backdrop-blur-sm shadow-xl rounded-full px-4 py-2">
            <div class="flex items-center justify-center w-8 h-8 bg-primary/20 text-primary rounded-full font-bold text-sm tracking-wider">
              ${generateInitials(data.settings.name)}
            </div>
            <div class="flex items-center gap-1 text-muted">
                ${navLinks}
            </div>
          </nav>
        </header>

        <div id="mobile-sidebar" class="fixed top-0 left-0 h-full w-64 bg-surface border-r border-border shadow-lg transform -translate-x-full transition-transform z-50">
          <div class="p-6 pt-20">
            <nav class="flex flex-col gap-4">
              ${data.navigation.items.map((item) => `
                <a href="${item.url}" class="text-lg text-body hover:text-primary transition-colors">${item.name}</a>
              `).join("")}
            </nav>
          </div>
        </div>

        <button id="hamburger-menu" class="md:hidden fixed top-4 left-4 z-[60] p-2 rounded-md bg-surface border border-border text-heading" aria-label="Open menu">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      `;
                }

                let ctaButtonsHTML = "";
                if (data.sections.hero && data.sections.hero.enabled) {
                    ctaButtonsHTML = data.sections.hero.ctaButtons
                        .map((btn) => `
        <a href="${btn.url}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 px-4 py-2 text-sm border border-border rounded-md hover:bg-surface hover:text-heading transition-colors">
          ${btn.text}
        </a>`).join("");
                }

                let skillsHTML = "";
                if (data.sections.about && data.sections.about.enabled) {
                    if (data.sections.about.skills && data.sections.about.skills.enabled) {
                        skillsHTML = `
          <div class="mt-16">
              <h2 class="font-bold text-xl text-heading mb-6">${data.sections.about.skills.title}</h2>
              <div class="flex flex-wrap gap-3">
                  ${data.sections.about.skills.items.map((skill) =>
                            `<span class="text-sm px-3 py-1 rounded-full bg-surface text-secondary font-mono border border-border/50">${skill}</span>`
                        ).join("")}
              </div>
          </div>
        `;
                    }
                }

                let projectsHTML = "";
                if (data.sections.projects && data.sections.projects.enabled) {
                    projectsHTML = `
        <div class="mt-16" id="projects">
          ${createSectionDivider(data.sections.projects.title)}
          <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
            ${data.sections.projects.items.map((project) => `
            <div class="mb-8">
              <h3 class="font-medium text-lg text-primary">${project.title}</h3>
              <p class="text-muted text-sm leading-relaxed mb-3">${project.description}</p>
              <div class="flex flex-wrap gap-2 mb-4">
                ${project.tags.map((tag) =>
                        `<span class="text-xs px-2 py-1 rounded bg-surface text-accent font-mono">${tag}</span>`
                    ).join("")}
              </div>
              <div class="flex items-center gap-4 text-sm">
                ${project.previewUrl ? `<a href="${ensureUrl(project.previewUrl)}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 text-secondary hover:text-heading transition-colors underline"><span>Preview</span></a>` : ""}
                ${project.repoUrl ? `<a href="${ensureUrl(project.repoUrl)}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 text-secondary hover:text-heading"> ${getIconSVG("repo")} <span>View Repo</span></a>` : ""}
              </div>
            </div>
          `).join("")}
          </div>
        </div>
      `;
                }

                let experienceHTML = "";
                if (data.sections.experience && data.sections.experience.enabled) {
                    const experienceItemsHTML = data.sections.experience.items.map((item) => `
        <div class="mb-8">
          <h3 class="font-medium text-lg text-primary">${item.position}</h3>
          <p class="text-body text-base mb-2">${item.company}</p>
          <p class="text-muted text-sm font-mono">${item.period}</p>
          <p class="text-muted text-sm leading-relaxed">${item.description}</p>
        </div>
      `).join("");

                    experienceHTML = `
        <div class="mt-16" id="experience">
            ${createSectionDivider(data.sections.experience.title)}
            ${experienceItemsHTML}
        </div>
      `;
                }

                let educationHTML = "";
                if (data.sections.education && data.sections.education.enabled) {
                    const educationItemsHTML = data.sections.education.items.map((item) => `
        <div class="mb-6">
            <div class="flex justify-between items-baseline mb-1">
                <h3 class="font-medium text-lg text-primary">${item.degree}</h3>
                <div class="text-sm text-muted font-mono">${item.period}</div>
            </div>
            <p class="text-muted text-base">${item.institution}</p>
        </div>
      `).join("");

                    educationHTML = `
        <div class="mt-16" id="education">
            ${createSectionDivider(data.sections.education.title)}
            ${educationItemsHTML}
        </div>
      `;
                }

                let achievementsHTML = "";
                if (data.sections.achievements && data.sections.achievements.enabled) {
                    const achievementItemsHTML = data.sections.achievements.items.map((item) => `
        <div class="mb-6">
          <h3 class="font-medium text-lg text-primary">${item.title}</h3>
          <p class="text-muted text-sm">${item.description}</p>
        </div>
      `).join("");

                    achievementsHTML = `
        <div class="mt-16" id="achievements">
          ${createSectionDivider(data.sections.achievements.title)}
          ${achievementItemsHTML}
        </div>
      `;
                }

                let contactHTML = "";
                if (data.sections.contact && data.sections.contact.enabled) {
                    const contactItems = [
                        { value: data.sections.contact.email, link: `mailto:${data.sections.contact.email}` },
                        { value: data.sections.contact.phone, link: `tel:${data.sections.contact.phone}` },
                        { value: data.sections.contact.location, link: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(data.sections.contact.location)}` },
                    ].filter((item) => item.value).map((item) =>
                        `<a href="${item.link}" target="_blank" rel="noopener noreferrer" class="text-secondary hover:text-heading transition-colors underline w-fit">${item.value}</a>`
                    ).join("");

                    contactHTML = `
        <div class="mt-8" id="contact">
           ${createSectionDivider(data.sections.contact.title)}
            <div class="flex flex-col items-center gap-4 text-sm">
                <div class="flex flex-row flex-wrap justify-center gap-x-8 gap-y-2">
                  ${contactItems}
                </div>
                <div class="flex items-center gap-4 mt-4">
                  ${socialLinksHTML}
                </div>
            </div>
        </div>
      `;
                }

                const content = `${headerHTML}
    <div class="flex flex-col min-h-screen">
      <!-- Theme toggle removed -->
      <main class="flex-grow max-w-4xl mx-auto px-6 pt-40 pb-8 animate-blur-in">
        <header class="grid md:grid-cols-3 gap-12 items-center mb-16">
            <div class="md:col-span-1 flex justify-center">
              <img src="${data.settings.profileImage}" alt="Profile" class="rounded-full w-40 h-40 object-cover border-4 border-surface" loading="lazy">
            </div>
            <div class="md:col-span-2">
                <h1 class="text-3xl font-medium text-heading">Hey, I'm ${data.settings.name}</h1>
                <p class="text-lg text-secondary mt-2">${data.settings.title} &bull; ${data.settings.location}</p>
                 <div class="flex flex-wrap gap-4 mt-6">
                  ${ctaButtonsHTML}
                </div>
            </div>
        </header>

        <p class="text-lg text-body leading-relaxed my-16">${data.settings.summary}</p>
        
        ${skillsHTML}
        ${projectsHTML}
        ${experienceHTML}
        ${educationHTML}
        ${achievementsHTML}
        ${contactHTML}

      </main>
    </div>
    `;

                document.getElementById("app").innerHTML = content;

                // Sidebar Logic
                const hamburgerMenu = document.getElementById("hamburger-menu");
                const sidebar = document.getElementById("mobile-sidebar");

                if (hamburgerMenu && sidebar) {
                    function openSidebar() {
                        sidebar.classList.remove("-translate-x-full");
                        hamburgerMenu.setAttribute("aria-expanded", "true");
                        sidebar.focus();
                    }

                    function closeSidebar() {
                        sidebar.classList.add("-translate-x-full");
                        hamburgerMenu.setAttribute("aria-expanded", "false");
                    }

                    hamburgerMenu.addEventListener("click", () => {
                        const isOpen = !sidebar.classList.contains("-translate-x-full");
                        if (isOpen) closeSidebar();
                        else openSidebar();
                    });

                    sidebar.querySelectorAll("a").forEach((link) => {
                        link.addEventListener("click", () => {
                            sidebar.classList.add("-translate-x-full");
                        });
                    });

                    document.addEventListener("click", (event) => {
                        if (!sidebar.contains(event.target) && !hamburgerMenu.contains(event.target)) {
                            closeSidebar();
                        }
                    });
                }
            } catch (err) {
                document.getElementById("app").innerHTML = `<div class="text-destructive p-8">${err}</div>`;
                console.error(err);
            }
        }

        document.addEventListener("DOMContentLoaded", renderPortfolio);
    </script>
</body>

</html>